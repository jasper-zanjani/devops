
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://jasper-zanjani.github.io/devops/Cloud/Azure/Azure-Monitoring/">
      
      
        <link rel="prev" href="../Azure-Key-Vault/">
      
      
        <link rel="next" href="../Azure-Policy/">
      
      
      <link rel="icon" href="../../../favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Azure Monitoring - DevOps</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M512%2080c0%2018-14.3%2034.6-38.4%2048-29.1%2016.1-72.5%2027.5-122.3%2030.9-3.7-1.8-7.4-3.5-11.3-5-39.4-16.5-91.8-25.9-148-25.9-8.3%200-16.4.2-24.5.6l-1.1-.6C142.3%20114.6%20128%2098%20128%2080c0-44.2%2086-80%20192-80s192%2035.8%20192%2080m-351.3%2081.1c10.2-.7%2020.7-1.1%2031.3-1.1%2062.2%200%20117.4%2012.3%20152.5%2031.4%2024.8%2013.5%2039.5%2030.3%2039.5%2048.6q0%206-2.1%2011.7c-4.6%2013.2-17%2025.3-35%2035.5-.1.1-.3.1-.4.2-.3.2-.6.3-.9.5-35%2019.4-90.8%2032-153.6%2032-59.6%200-112.9-11.3-148.2-29.1-1.9-.9-3.7-1.9-5.5-2.9C14.3%20274.6%200%20258%200%20240c0-34.8%2053.4-64.5%20128-75.4%2010.5-1.5%2021.4-2.7%2032.7-3.5M416%20240c0-21.9-10.6-39.9-24.1-53.4%2028.3-4.4%2054.2-11.4%2076.2-20.5%2016.3-6.8%2031.5-15.2%2043.9-25.5V176c0%2019.3-16.5%2037.1-43.8%2050.9-14.6%207.4-32.4%2013.7-52.4%2018.5.1-1.8.2-3.5.2-5.3zm-32%2096c0%2018-14.3%2034.6-38.4%2048-1.8%201-3.6%201.9-5.5%202.9C304.9%20404.7%20251.6%20416%20192%20416c-62.8%200-118.6-12.6-153.6-32C14.3%20370.6%200%20354%200%20336v-35.4c12.5%2010.3%2027.6%2018.7%2043.9%2025.5C83.4%20342.6%20135.8%20352%20192%20352s108.6-9.4%20148.1-25.9c7.8-3.2%2015.3-6.9%2022.4-10.9%206.1-3.4%2011.8-7.2%2017.2-11.2%201.5-1.1%202.9-2.3%204.3-3.4V336m32%200v-57.9c19-4.2%2036.5-9.5%2052.1-16%2016.3-6.8%2031.5-15.2%2043.9-25.5V272c0%2010.5-5%2021-14.9%2030.9-16.3%2016.3-45%2029.7-81.3%2038.4.1-1.7.2-3.5.2-5.3M192%20448c56.2%200%20108.6-9.4%20148.1-25.9%2016.3-6.8%2031.5-15.2%2043.9-25.5V432c0%2044.2-86%2080-192%2080S0%20476.2%200%20432v-35.4c12.5%2010.3%2027.6%2018.7%2043.9%2025.5C83.4%20438.6%20135.8%20448%20192%20448%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22m7.775%203.275%201.25-1.25a3.5%203.5%200%201%201%204.95%204.95l-2.5%202.5a3.5%203.5%200%200%201-4.95%200%20.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018%202%202%200%200%200%202.83%200l2.5-2.5a2.002%202.002%200%200%200-2.83-2.83l-1.25%201.25a.75.75%200%200%201-1.042-.018.75.75%200%200%201-.018-1.042m-4.69%209.64a2%202%200%200%200%202.83%200l1.25-1.25a.75.75%200%200%201%201.042.018.75.75%200%200%201%20.018%201.042l-1.25%201.25a3.5%203.5%200%201%201-4.95-4.95l2.5-2.5a3.5%203.5%200%200%201%204.95%200%20.75.75%200%200%201-.018%201.042.75.75%200%200%201-1.042.018%202%202%200%200%200-2.83%200l-2.5%202.5a2%202%200%200%200%200%202.83%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#log-analytics" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="DevOps" class="md-header__button md-logo" aria-label="DevOps" data-md-component="logo">
      
  <img src="../../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DevOps
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Azure Monitoring
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="DevOps" class="md-nav__button md-logo" aria-label="DevOps" data-md-component="logo">
      
  <img src="../../../logo.png" alt="logo">

    </a>
    DevOps
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automation using Azure DevOps and Ansible
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ADO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Devops
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Ansible/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../github/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub Actions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Cloud
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tasks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gcp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Google Cloud Platform
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AWS
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            AWS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AWS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AWS/ebs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EBS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AWS/ec2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EC2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AWS/iam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IAM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AWS/ml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Machine learning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../AWS/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    S3
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Azure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Azure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ARM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ARM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Azure-Backup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Backup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Azure-File-Service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure File Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Azure-IAM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure IAM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Azure-IaaS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure IaaS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Azure-Key-Vault/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Key Vault
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Azure Monitoring
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Azure Monitoring
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#log-analytics" class="md-nav__link">
    <span class="md-ellipsis">
      Log Analytics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Log Analytics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operational-insights" class="md-nav__link">
    <span class="md-ellipsis">
      Operational Insights
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-insights" class="md-nav__link">
    <span class="md-ellipsis">
      Application Insights
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alerts" class="md-nav__link">
    <span class="md-ellipsis">
      Alerts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Alerts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#actions" class="md-nav__link">
    <span class="md-ellipsis">
      Actions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vms" class="md-nav__link">
    <span class="md-ellipsis">
      VMs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Tasks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-diagnostics-on-a-vm" class="md-nav__link">
    <span class="md-ellipsis">
      Enable diagnostics on a VM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnostics-log-collection-with-a-storage-account" class="md-nav__link">
    <span class="md-ellipsis">
      Diagnostics log collection with a storage account
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnostics-log-streaming-to-an-event-hub" class="md-nav__link">
    <span class="md-ellipsis">
      Diagnostics log streaming to an Event Hub
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnostics-log-collection-in-a-log-analytics-workspace" class="md-nav__link">
    <span class="md-ellipsis">
      Diagnostics log collection in a Log Analytics workspace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-an-alert-rule" class="md-nav__link">
    <span class="md-ellipsis">
      Create an alert rule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-log-analytics-workspace" class="md-nav__link">
    <span class="md-ellipsis">
      Create Log Analytics workspace
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sources" class="md-nav__link">
    <span class="md-ellipsis">
      Sources
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Azure-Policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Policy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Azure-Storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Azure-VPN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure VPN
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Kusto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kusto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appservice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appservice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../entra-id/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entra id
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    IBM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            IBM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../IBM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IBM Cloud
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Kubernetes/helm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Helm
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Terraform
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Terraform
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Terraform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terraform
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tasks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Tasks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1" id="__nav_7_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AWS
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1">
            <span class="md-nav__icon md-icon"></span>
            AWS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Terraform/Tasks/AWS/create-user/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create user
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Terraform/Tasks/AWS/deploy-vm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploy VM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Terraform/Tasks/AWS/eks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EKS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2_2" id="__nav_7_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Azure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_2">
            <span class="md-nav__icon md-icon"></span>
            Azure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Terraform/Tasks/Azure/00-provider/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    provider
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Terraform/Tasks/Azure/01-group/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    azurerm_resource_group
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Terraform/Tasks/Azure/10-vnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    azurerm_virtual_network
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_3" >
        
          
          <label class="md-nav__link" for="__nav_7_2_3" id="__nav_7_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Basics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_3">
            <span class="md-nav__icon md-icon"></span>
            Basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Terraform/Tasks/Basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hello, World!
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_4" >
        
          
          <label class="md-nav__link" for="__nav_7_2_4" id="__nav_7_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    IBM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_4">
            <span class="md-nav__icon md-icon"></span>
            IBM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Terraform/Tasks/IBM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IBM Cloud tasks
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<p>A robust monitoring strategy implementing proactive notifications helps to increase uptime and optimize performance. Azure offers <strong>Azure Monitor</strong> and <strong>Azure Advisor</strong>.</p>
<ul>
<li><a href="#azure-monitor"><strong>Azure Monitor</strong></a> brings a unified alerting experience to Azure, with a single pane of glass for interacting with metrics, the <strong>Activity Log</strong>, <strong>Log Analytics</strong>, service and resource health and service-specific insights. <ul>
<li>Alerts can be filtered by subscription (maximum of 5), resource group (maximum of 1), resource type (available selections depend on resources deployed to selected group) time range (past hour, past day, past week, and past 30 days), and other criteria.</li>
<li>Azure Monitor can create <a href="#alerts"><strong>alert rules</strong></a> that are built on target resources or resource type and that proactively notify you of the health of resources and can also leverage action groups that automate actions to take in certain conditions.</li>
</ul>
</li>
<li><strong>Azure Advisor</strong> is a free, personalized guide to Azure best practices that provides recommendations to help you optimize resources. 
Azure Advisor offers personalized recommendations across 4 domains: High availability, Security, Performance, and Cost</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: left;">Feature</th>
<th style="text-align: left;">Logs</th>
<th style="text-align: left;">Metrics</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Retention</strong></td>
<td style="text-align: left;">Stored in Log Analytics (2 years)</td>
<td style="text-align: left;">Stored in Monitor for 93 days, but metrics can be sent to Log Analytics and Storage accounts as well</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Properties</strong></td>
<td style="text-align: left;">Varying properties for each log, with support for rich data types such as date and time</td>
<td style="text-align: left;">Fixed set of properties (or attributes): time, type, resource, value, and (optionally) dimensions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Data availability</strong></td>
<td style="text-align: left;">Triggered by an event, requiring time to process before they are available for querying</td>
<td style="text-align: left;">Gathered at intervals and available for immediate querying.</td>
</tr>
</tbody>
</table>
<p>Virtual machines can be one of the most expensive resources in a cloud implementation, and there are several ways to reduce their cost</p>
<ul>
<li>Deallocate compute when not needed</li>
<li>Delete unused virtual machines and allocate them only on demand</li>
<li>Right-size VMs so that you don't overuse resources</li>
</ul>
<p>Advisor can also identify</p>
<ul>
<li>ExpressRoute circuits that have been "Not Provisioned" for more than 30 days</li>
<li>Gateways that have been idle for more than 90 days</li>
</ul>
<p>There are two monitoring data streams:</p>
<ul>
<li><strong>Metrics</strong> are the numerical time series data produced by resources and services within Azure. They are collected at 1-minute intervals, identified by a metric name and namespace (category). Metrics can be one-dimensional or have up to 10 dimensions.<ul>
<li>Metrics have the following properties:<ul>
<li><strong>Time</strong> the value was collected</li>
<li><strong>Type</strong> of measurement made</li>
<li><strong>Resource</strong> associated with value</li>
<li><strong>Value</strong></li>
</ul>
</li>
<li>Metrics can be stored in:<ul>
<li>Azure Monitor for 93 days</li>
<li>Log Analytics for 2 years</li>
<li>Storage account, where they are treated according to the retention policy and storage limits of the account.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Logs</strong> come in various types</li>
<li><strong>Diagnostics logs</strong> (including <strong>resource logs</strong> and <strong>tenant logs</strong>) are a type of log data that can be configured to send data to other locations, such as a Storage account or <a href="#log-analytics">Log Analytics workspace</a>. Diagnostics logs have to be enabled for each resource to be monitored through the Portal by enabling Diagnostics Settings, and not all resource types support diagnostic logs. Of those that do, not all resources support a retention policy or sending metric data.</li>
<li><strong>Azure Activity logs</strong> is a subscription level log that captures events that range from operational data (i.e. resource creation, deletion) to service health events for a subscription, but lacks resource-level detail..</li>
<li><strong>Guest telemetry</strong> can relay logs from VMs with the use of diagnostics agents</li>
</ul>
<h2 id="log-analytics">Log Analytics</h2>
<p>A <strong>Log Analytics workspace</strong> is a form of abstracting the process of log collection and is used to collect and aggregate logs. Like any other resource, it must be associated with a location and a resource group. Any Azure resource can only report logs to a single workspace, but Azure Monitor allows multiple workspaces to be queried simultaneously. The logs can be queried through Log Analytics or Monitor. Because a workspace is a resource, RBAC can be applied to control access to it. </p>
<p>Log Analytics is based on Azure Data Explorer and uses <a href="Kusto">Kusto</a>.</p>
<p>Log Analytics <a href="https://azure.microsoft.com/en-us/pricing/details/monitor/">pricing</a> is divided into <strong>data ingestion</strong> and <strong>data retention</strong>:
- Under <strong>Pay-As-You-Go</strong> data ingestion the first 5 GB per month are free and further data is charged at a rate of $2.76/GB/month
- <strong>Capacity Reservations</strong> offer a discount on Pay-as-you-go by charging a fixed amount per day ($219.52/day for 100 GB), with further discounts at higher tiers
- Data retention is free for any amount of data up to 31 days, and 90 days for <a href="Azure-Sentinel">Azure Sentinel</a>-enabled workspaces</p>
<h3 id="operational-insights">Operational Insights</h3>
<p>Log Analytics was previously named <strong>Operational Insights</strong>, which was named <a href="https://en.wikipedia.org/wiki/System_Center_Advisor"><strong>System Center Advisor</strong></a> prior to 2014.</p>
<h2 id="application-insights">Application Insights</h2>
<p>Application Insights is a platfrom separate from Log Analytics which is intended to monitor web applications.</p>
<h2 id="alerts">Alerts</h2>
<p>Alerts can be created from the Alerts pane in the Monitor blade:
<img alt="" src="/img/az-monitor-alerts.png" /></p>
<p>Most resource blades also have Alerts in the resource menu under Monitoring.</p>
<p><strong>Alert rules</strong>, which are used to generate alerts, contain
- <strong>Target resource</strong>, any Azure resource that generates signals, defines the scope and signals available for the alert.
- <strong>Signal</strong> (i.e. metric or Activity Log) emitted by target resource. Signals are of 3 types: 
  1. Metrics
  2. Log search queries 
  3. Activity logs
- <strong>Conditional logic</strong> for alert combines the signal and a logical test to trigger alert.
- <strong>Action Group</strong> determines what will happen when the alert is trigged. Action groups are themselves resources, and thus located in a subscription and resource group, and have:
  - <strong>Name</strong>
  - <strong>Short name</strong> is used to identify the Action Group in emails and notifications and is limited to 12 characters
  - <a href="#actions"><strong>Actions</strong></a> define the configuration for a specific action type. 
- Severity (0-4)</p>
<p>Alerts can have 3 states:</p>
<ul>
<li><strong>New</strong> and not reviewed</li>
<li><strong>Acknowledged</strong> issue is being actioned by an admin</li>
<li><strong>Closed</strong> issue that generated the alerts has been resolved and the alert has been marked as closedAlerts have many notification options, including email, SMS, mobile app, voice, and integration with automation. </li>
</ul>
<h3 id="actions">Actions</h3>
<p><img alt="" src="/img/az-action-group.png" /></p>
<p>A single action group can trigger multiple actions. Available types include: Email/SMS/Push/Voice, Azure Function, Logic App, Webhook, ITSM, and Automation Runbook</p>
<ul>
<li><strong>IT Service Management Connector</strong> up to 10 ITSM actions can be configured with an ITSM connection</li>
<li>Supported providers include ServiceNow, System Center Service Manager, Provance, and Cherwell <img alt="ðŸ‘‰" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f449.svg" title=":point_right:" /> <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/platform/itsmc-overview">Connect Azure to ITSM tools using ITSMC</a></li>
<li><a href="https://docs.microsoft.com/azure/monitoring-and-diagnos-tics/insights-webhooks-alerts">Webhooks</a></li>
<li>Runbook runs in Azure Automation Service <a href="https://azure.microsoft.com/blog/automatically-remediate-azure-vm-alerts-with-automation-run-books/">Runbooks</a></li>
</ul>
<p>The maximum number of alert notifications per hour:
- Email: 60
- Voice: 12
- SMS: 12</p>
<h2 id="vms">VMs</h2>
<p><img alt="" src="/img/az-vm-insights.png" /></p>
<p>"Virtual Machine <strong>Insights</strong>" (or "Azure Monitor for VMs") is the successor to older monitoring workflow that used "guest OS diagnostics" in conjunction with Metrics Explorer. It requires a <a href="#log-analytics">log analytics workspace</a>.
<strong>Diagnostic settings</strong>, conventionally, was the feature that would be enabled to allow Azure to collect metrics and logs from VMs, including <strong>event logs</strong> and performance counters.</p>
<p>Two primary views:
- <strong>Performance</strong> is a successor to the old Metrics Explorer
- <strong>Map</strong> (originally "Service Map")</p>
<h1 id="tasks">Tasks</h1>
<h3 id="enable-diagnostics-on-a-vm">Enable diagnostics on a VM</h3>
<p>Sources:
- <a href="https://docs.microsoft.com/en-us/cli/azure/vm/diagnostics?view=azure-cli-latest#az_vm_diagnostics_set"><code>az vm diagnostics set</code></a></p>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<h3 id="diagnostics-log-collection-with-a-storage-account">Diagnostics log collection with a storage account</h3>
<p>Browse to the resource itself. Alternatively, open <strong>Azure Monitor</strong> and then the <strong>Diagnostics Settings</strong> blade. From there you can view all eligible resouce types and view status of log collection. 
<div class="highlight"><pre><span></span><code><span class="nv">$resource</span> <span class="p">=</span> <span class="nb">Get-AzResource</span> <span class="n">-Name</span> <span class="nv">$resourceName</span> <span class="n">-ResourceGroupName</span> <span class="nv">$resourceGroupName</span>
<span class="nv">$storage</span> <span class="p">=</span> <span class="nb">Get-AzResource</span> <span class="n">-Name</span> <span class="nv">$resourceName</span> <span class="n">-ResourceGroupName</span> <span class="nv">$resourceGroupName</span>
<span class="nb">Set-AzDiagnosticSetting</span> <span class="n">-ResourceId</span> <span class="nv">$resource</span><span class="p">.</span><span class="n">ResourceId</span> <span class="n">-StorageAccountId</span> <span class="nv">$storage</span><span class="p">.</span><span class="n">ResourceId</span> <span class="n">-Enabled</span> <span class="nv">$true</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nv">resourceId</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>resource<span class="w"> </span>show<span class="w"> </span>-resource-group<span class="w"> </span><span class="nv">$resourceGroupName</span><span class="w"> </span>-name<span class="w"> </span><span class="nv">$resourceName</span><span class="w"> </span>--resource-type<span class="w"> </span><span class="nv">$resourceType</span><span class="w"> </span>--query<span class="w"> </span>id<span class="w"> </span>--output<span class="w"> </span>tsv<span class="k">)</span>
az<span class="w"> </span>monitor<span class="w"> </span>diagnostic-settings<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="nv">$diagnosticName</span><span class="w"> </span>--storage-account<span class="w"> </span><span class="nv">$storageId</span><span class="w"> </span>--resource<span class="w"> </span><span class="nv">$resouceId</span><span class="w"> </span>--resource-group<span class="w"> </span><span class="nv">$resourceGroup</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--logs<span class="w"> </span><span class="s1">&#39;[ {</span>
<span class="s1">    &quot;category&quot;: &lt;categoryName&gt;,</span>
<span class="s1">    &quot;enabled&quot;: true,</span>
<span class="s1">    &quot;retentionPolicy&quot;: {</span>
<span class="s1">      &quot;days&quot;: &lt;numberOfDays&gt;,</span>
<span class="s1">      &quot;enabled&quot;: true } } ] &#39;</span>
</code></pre></div></p>
<h3 id="diagnostics-log-streaming-to-an-event-hub">Diagnostics log streaming to an Event Hub</h3>
<p><div class="highlight"><pre><span></span><code><span class="nv">$rule</span> <span class="p">=</span> <span class="nb">Get-AzServiceBusRule</span> <span class="n">-ResourceGroup</span> <span class="nv">$resourceGroupName</span> <span class="n">-Namespace</span> <span class="nv">$namespace</span> <span class="n">-Topic</span> <span class="nv">$topic</span> <span class="n">-Subscription</span> <span class="nv">$subscription</span> <span class="n">-Name</span> <span class="nv">$ruleName</span>
<span class="nb">Set-AzDiagnosticSetting</span> <span class="n">-ResourceId</span> <span class="nv">$resource</span><span class="p">.</span><span class="n">ResourceId</span> <span class="n">-ServiceBusRuleId</span> <span class="nv">$rule</span><span class="p">.</span><span class="n">Id</span> <span class="n">-Enabled</span> <span class="nv">$true</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nv">resourceId</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>resource<span class="w"> </span>show<span class="w"> </span>-resource-group<span class="w"> </span><span class="nv">$resourceGroupName</span><span class="w"> </span>-name<span class="w"> </span><span class="nv">$resourceName</span><span class="w"> </span>--resource-type<span class="w"> </span><span class="nv">$resourceType</span><span class="w"> </span>--query<span class="w"> </span>id<span class="w"> </span>--output<span class="w"> </span>tsv<span class="k">)</span>
az<span class="w"> </span>monitor<span class="w"> </span>diagnostic-settings<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="nv">$diagnosticName</span><span class="w"> </span>--event-hub<span class="w"> </span><span class="nv">$eventHubName</span><span class="w"> </span>--event-hub-rule<span class="w"> </span><span class="nv">$eventHubRuleId</span><span class="w"> </span>--resource<span class="w"> </span><span class="nv">$resourceId</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--logs<span class="w"> </span><span class="s1">&#39;[{</span>
<span class="s1">    &quot;category&quot;: &lt;categoryName&gt;,</span>
<span class="s1">    &quot;enabled&quot;: true }]&#39;</span>
</code></pre></div></p>
<h3 id="diagnostics-log-collection-in-a-log-analytics-workspace">Diagnostics log collection in a Log Analytics workspace</h3>
<p>The <a href="https://docs.microsoft.com/en-us/powershell/module/az.operationalinsights/get-azoperationalinsightsworkspace?view=azps-5.0.0">PowerShell module</a> that allows interaction with Log Analytics still refers to the service's <a href="#operational-insights">old name</a>.</p>
<p><div class="highlight"><pre><span></span><code><span class="nv">$workspace</span> <span class="p">=</span> <span class="nb">Get-AzOperationalInsightsWorkspace</span> <span class="n">-Name</span> <span class="nv">$logAnalyticsName</span> <span class="n">-ResourceGroupName</span> <span class="nv">$g</span>
<span class="nb">Set-AzDiagnosticSetting</span> <span class="n">-ResourceId</span> <span class="nv">$r</span><span class="p">.</span><span class="n">ResourceId</span> <span class="n">-WorkspaceId</span> <span class="nv">$workspace</span><span class="p">.</span><span class="n">ResourceId</span> <span class="n">-Enabled</span> <span class="nv">$true</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>az<span class="w"> </span>monitor<span class="w"> </span>diagnostic-settings<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="nv">$diagnosticName</span><span class="w"> </span>--workspace<span class="w"> </span><span class="nv">$logAnalyticsName</span><span class="w"> </span>--resource<span class="w"> </span><span class="nv">$rid</span><span class="w"> </span>--resouce-group<span class="w"> </span><span class="nv">$g</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--logs<span class="w"> </span><span class="s1">&#39;[{</span>
<span class="s1">    &quot;category&quot;: &lt;categoryName&gt;,</span>
<span class="s1">    &quot;enabled&quot;: true }]&#39;</span>
</code></pre></div></p>
<h3 id="create-an-alert-rule">Create an alert rule</h3>
<p>Sources:
- <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/platform/alerts-activity-log">Create, view, and manage activity log alerts by using Azure Monitor</a></p>
<p><img alt="" src="/img/manage-action-groups.png" /></p>
<p><img alt="" src="/img/create-new-alert-rule-options.png" /></p>
<h3 id="create-log-analytics-workspace">Create Log Analytics workspace</h3>
<h1 id="sources">Sources</h1>
<ul>
<li>AZ-103: <a href="AZ-103#12-analyze-resource-utilization-and-consumption" title="Analyze resource utilization and consumption"><code>1.2</code></a></li>
<li>
<p>AZ-104: <a href="AZ-104#51-monitor-resources-by-using-azure-monitor" title="Monitor resources by using Azure Monitor"><code>5.1</code></a></p>
</li>
<li>
<p><a href="https://app.pluralsight.com/course-player?clipId=f281d048-7e2a-4312-9200-4665a12fd126">Azure Monitor for VMs</a></p>
</li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.sections", "navigation.expand", "toc.integrate", "content.code.annotate", "content.code.copy", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>